*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:radial-gradient(circle at 50% 15%,#221238 0%,#090513 65%,#05040e 100%);color:#fff;font-family:'Manrope',-apple-system,BlinkMacSystemFont,'SF Pro Text','Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;overflow:hidden;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
#app{position:relative;width:100vw;height:100vh;min-height:100vh}
@supports (height: 100svh){#app{height:100svh;min-height:100svh}}
@supports (height: 100dvh){#app{height:100dvh;min-height:100dvh}}

/* INTRO */
#intro{position:absolute;inset:0;width:100%;height:100%;display:block;z-index:5;transition:opacity 1.4s ease;will-change:opacity}
#intro.hidden{opacity:0;pointer-events:none}
#scene{transform-box:fill-box;transform-origin:50% 72%}
#sunGroup{transform-box:fill-box;transform-origin:50% 50%}
#clouds{transform-box:fill-box;transform-origin:50% 50%}
#mountains{transform-box:fill-box;transform-origin:50% 100%}
#celestial{mix-blend-mode:screen}
#sunHalo{mix-blend-mode:screen}
#introText{font-family:'Manrope',sans-serif;font-size:clamp(15px,calc(1.15vw + 1.1vh),26px);--intro-letter:clamp(.12em,calc(.04em + .28vw),.22em);letter-spacing:var(--intro-letter);text-transform:uppercase;fill:#ffe4f9;animation:introTextGlow 6.4s ease-in-out infinite;paint-order:stroke fill;stroke:#ffffff10;stroke-width:.4px}
#introText tspan{white-space:pre;dominant-baseline:middle}
@media (max-width:480px){#introText{font-size:clamp(14px,4.4vw,20px);--intro-letter:clamp(.1em,calc(.05em + .2vw),.18em)}}
@media (orientation:landscape){#introText{font-size:clamp(14px,2.4vh,20px);--intro-letter:clamp(.1em,calc(.05em + .18vw),.18em)}}

.orientation-lock{position:absolute;inset:0;display:none;align-items:center;justify-content:center;text-align:center;padding:40px 32px;z-index:20;background:radial-gradient(120% 120% at 50% 50%,rgba(18,14,38,.88),rgba(5,4,14,.96));backdrop-filter:blur(16px);font-family:'Manrope',sans-serif;font-size:clamp(16px,4.6vw,22px);line-height:1.4;letter-spacing:.04em;color:#f2e8ff;text-transform:uppercase}
.orientation-lock::after{content:"";position:absolute;inset:18%;border-radius:36px;border:1px solid rgba(255,255,255,.1);pointer-events:none}
body.landscape-locked .orientation-lock{display:flex}
body.landscape-locked #app>:not(.orientation-lock){visibility:hidden;pointer-events:none}

@keyframes introTextGlow{0%,100%{fill:#ffe6f9;stroke:#ffffff10;opacity:.9;letter-spacing:var(--intro-letter)}50%{fill:#fff6ff;stroke:#ffe4ff33;opacity:1;letter-spacing:calc(var(--intro-letter) + .04em)}}

/* Пост-интро слои */
#space-wrapper{position:absolute;inset:0;overflow:hidden;z-index:1;touch-action:none;cursor:grab}
#space-wrapper.panning{cursor:grabbing}
#space{position:absolute;top:0;left:0;will-change:transform;transform-origin:0 0}
#bg,#fx{position:absolute;inset:0;width:100%;height:100%;display:block;pointer-events:none;z-index:1}
#stars-layer{position:absolute;inset:0;width:100%;height:100%;pointer-events:none;z-index:2}
.star{position:absolute;width:var(--size,12px);height:var(--size,12px);left:var(--x,50%);top:var(--y,50%);transform:translate(-50%,-50%);pointer-events:auto;border-radius:50%;background:
  radial-gradient(circle at 50% 50%,#fff 0%,rgba(255,255,255,.92) 35%,rgba(255,255,255,.3) 55%,rgba(140,170,255,0) 75%),
  radial-gradient(circle at 50% 50%,rgba(100,140,255,.28) 0%,rgba(100,140,255,0) 70%);
box-shadow:0 0 14px rgba(170,200,255,.75),0 0 32px rgba(120,160,255,.35);
animation:twinkle var(--tw,2.8s) ease-in-out infinite;cursor:pointer;border:none;appearance:none;outline:none}
.star:focus-visible{outline:2px solid rgba(255,255,255,.6);outline-offset:4px;box-shadow:0 0 20px rgba(170,200,255,.85),0 0 38px rgba(120,160,255,.55)}
.star::before,.star::after{content:'';position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.8),rgba(255,255,255,0));border-radius:999px;opacity:.85;filter:blur(.2px)}
.star::before{width:190%;height:28%}
.star::after{width:28%;height:190%;background:linear-gradient(0deg,rgba(255,255,255,0),rgba(255,255,255,.8),rgba(255,255,255,0))}
.star.visited{background:
  radial-gradient(circle at 50% 50%,#ffe3f4 0%,#ff9fce 48%,rgba(255,116,188,0.38) 72%,rgba(255,116,188,0) 100%);
box-shadow:0 0 16px rgba(255,126,191,.8),0 0 34px rgba(255,114,185,.45)}
.star.visited::before{background:linear-gradient(90deg,rgba(255,158,205,0),rgba(255,158,205,.95),rgba(255,158,205,0))}
.star.visited::after{background:linear-gradient(0deg,rgba(255,158,205,0),rgba(255,158,205,.95),rgba(255,158,205,0))}
.star.heart-star{transform:translate(-50%,-50%) rotate(var(--heart-tilt,0deg));animation:twinkle var(--tw,2.8s) ease-in-out infinite,heartPulse 6.4s ease-in-out infinite;transition:left 2.8s cubic-bezier(.22,.68,.3,1),top 2.8s cubic-bezier(.22,.68,.3,1);box-shadow:0 0 26px rgba(255,144,213,.88),0 0 70px rgba(255,120,198,.46)}
.star.heart-star::before{opacity:.95}
.star.heart-star::after{opacity:.95}
@keyframes heartPulse{0%,100%{transform:translate(-50%,-50%) rotate(var(--heart-tilt,0deg)) scale(1.08);box-shadow:0 0 28px rgba(255,150,220,.9),0 0 90px rgba(255,130,206,.55)}50%{transform:translate(-50%,-50%) rotate(var(--heart-tilt,0deg)) scale(1.24);box-shadow:0 0 38px rgba(255,168,228,.98),0 0 120px rgba(255,146,214,.68)}}
#stars-layer.heart-mode{pointer-events:none}
#stars-layer.heart-mode .star{pointer-events:none}
.heart-outline{position:absolute;inset:0;width:100%;height:100%;pointer-events:none;z-index:1}
.heart-outline path{fill:none;stroke:#ff8fd8;stroke-width:2.6;stroke-linecap:round;stroke-linejoin:round;filter:drop-shadow(0 0 22px rgba(255,134,210,.52));transition:stroke-dashoffset 5.4s cubic-bezier(.35,.75,.2,1)}
.heart-outline path.draw{stroke:#ff9fdf}
.constellation-lines{position:absolute;inset:0;width:100%;height:100%;pointer-events:none;z-index:1}
.constellation-lines line{stroke:rgba(210,220,255,.85);stroke-width:1.8;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:8 18;filter:drop-shadow(0 0 6px rgba(180,200,255,.6));animation:constellationFlow var(--flow-duration,5s) linear infinite,constellationPulse var(--pulse-duration,3.6s) ease-in-out infinite}
@keyframes constellationFlow{0%{stroke-dashoffset:0}100%{stroke-dashoffset:-26}}
@keyframes constellationPulse{0%,100%{opacity:.55}50%{opacity:.92}}
@keyframes twinkle{0%,100%{opacity:.65;scale:.96}50%{opacity:1;scale:1.18}}

/* Модалка */
#memory{position:absolute;inset:0;display:grid;place-items:center;backdrop-filter:blur(12px) saturate(115%);background:radial-gradient(1200px 800px at 50% 50%,rgba(24,34,56,.55),rgba(0,0,0,.75));transition:opacity .5s ease;z-index:10}
#memory.hidden{opacity:0;pointer-events:none}
.memory-frame{position:relative;max-width:min(92vw,720px);width:92vw;border-radius:20px;overflow:clip;background:linear-gradient(135deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.16);box-shadow:0 18px 60px rgba(0,0,0,.55),0 0 80px rgba(160,200,255,.25) inset;animation:cardIn 520ms cubic-bezier(.2,.8,.2,1) both}
@keyframes cardIn{from{opacity:0;transform:translateY(12px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}
.memory-frame img{width:100%;display:block;aspect-ratio:4/5;object-fit:cover;filter:contrast(1.05) saturate(1.02)}
.caption{padding:12px 16px 16px;font-size:14px;color:#e8efff;text-align:center;text-wrap:balance;background:linear-gradient(180deg,rgba(255,255,255,.03),transparent);font-family:'Manrope',sans-serif;letter-spacing:.02em}
.close{position:absolute;top:10px;right:10px;appearance:none;border:none;width:36px;height:36px;border-radius:50%;font-size:18px;color:#dfe8ff;background:rgba(10,16,28,.55);border:1px solid rgba(255,255,255,.2);backdrop-filter:blur(8px);cursor:pointer;transition:transform .15s ease, background .2s}
.close:active{transform:scale(.96)}

/* Подсказка */
#hint{position:absolute;bottom:calc(env(safe-area-inset-bottom) + 20px);left:50%;transform:translateX(-50%);padding:10px 16px;border-radius:999px;font-size:14px;color:#e8edff;background:rgba(12,18,30,.55);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.12);box-shadow:0 8px 24px rgba(0,0,0,.35);z-index:6;opacity:0;transition:opacity .6s ease;text-align:center;font-family:'Manrope',sans-serif;letter-spacing:.02em}
#hint.show{opacity:1}

/* Кнопка звука */
.audio-toggle{position:absolute;top:calc(env(safe-area-inset-top) + 16px);right:calc(env(safe-area-inset-right) + 16px);z-index:8;width:44px;height:44px;border-radius:50%;border:1px solid rgba(255,255,255,.22);background:rgba(10,16,28,.55);backdrop-filter:blur(10px);color:#e3ebff;font-size:20px;display:grid;place-items:center;cursor:pointer;transition:transform .2s ease,background .3s ease,box-shadow .3s ease;box-shadow:0 10px 28px rgba(0,0,0,.35)}
.audio-toggle.on{background:rgba(40,64,120,.6);box-shadow:0 12px 32px rgba(20,40,80,.45)}
.audio-toggle:focus-visible{outline:2px solid rgba(255,255,255,.65);outline-offset:3px}
.audio-toggle:active{transform:scale(.95)}
